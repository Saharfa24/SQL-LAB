-- 1. Display the USERID of any users who have not made an order.
--    Assumes an ORDERS table exists with USERID column.
SELECT USERID FROM USERBASE
MINUS
SELECT USERID FROM ORDERS;

-- 2. Display the PRODUCTCODE of any products that have no reviews.
--    Assumes REVIEWS table contains PRODUCTCODE.
SELECT PRODUCTCODE FROM PRODUCTLIST
MINUS
SELECT PRODUCTCODE FROM REVIEWS;

DESC COMMUNITYRULES;

-- 3. Display all data in the USERBASE table. Show another column that
--    states "Adult" for any user that is at least 18 years old, and
--    "Minor" for all other users.
SELECT u.*,
       CASE WHEN (SYSDATE - BIRTHDAY) / 365 >= 18 THEN 'Adult' ELSE 'Minor' END AS AGE_GROUP
FROM USERBASE u;

-- 4. Display all data in the PRODUCTLIST table. Show another column that
--    states "On Sale" for any product that is priced at $20 or less, and
--    "Base Price" for all other products.
SELECT P.*,
       CASE
           WHEN PRICE <= 20 THEN 'On Sale'
           ELSE 'Base Price'
       END AS SALE_STATUS
FROM PRODUCTLIST P;

-- 5. Display the USERID of any user who has played the product with a
--    PRODUCTCODE of GAME6 and has a user profile image.
--    Assumes USERLIBRARY tracks played games and USERPROFILE has PROFILEIMAGE.
-- Example: if tables are USER_GAMES and USER_PROFILE, and image column is HAS_IMAGE

DESC USERBASE;

SELECT DISTINCT USERID
FROM USERLIBRARY
WHERE PRODUCTCODE = 'GAME6';

-- 6. Display any PRODUCTCODE from the intersect of the WISHLIST and
--    REVIEWS table, where the product is in POSITION 1 or 2, and has a
--    review RATING of 3 or higher.
SELECT PRODUCTCODE FROM WISHLIST WHERE POSITION IN (1, 2)
INTERSECT
SELECT PRODUCTCODE FROM REVIEWS WHERE RATING >= 3;

-- 7. Display both user's USERNAME and BIRTHDAY for any users who share
--    the same BIRTHDAY.
SELECT USERNAME, BIRTHDAY
FROM USERBASE
WHERE BIRTHDAY IN (
    SELECT BIRTHDAY
    FROM USERBASE
    GROUP BY BIRTHDAY
    HAVING COUNT(*) > 1
);

-- 8. Display the Cartesian Product of the USERLIBRARY table cross joined
--    with the WISHLIST table.
SELECT *
FROM USERLIBRARY
CROSS JOIN WISHLIST;

-- 9. Perform a union all on the USERBASE and PRODUCTLIST tables to
--    generate data on all users and products.
DESC PRODUCTLIST;

SELECT TO_CHAR(USERID) AS ID,
       USERNAME AS NAME,
       'User' AS TYPE
FROM USERBASE

UNION ALL

SELECT PRODUCTCODE AS ID,
       PRODUCTNAME AS NAME,
       'Product' AS TYPE
FROM PRODUCTLIST;

-- 10. Perform a union all on the CHATLOG and USERPROFILE tables to
--     generate data on user activity.
--     Assumes CHATLOG has CHATDATE and MESSAGE; USERPROFILE has PROFILEUPDATEDATE.
DESC CHATLOG;

SELECT SENDERID AS USERID,
       CONTENT AS ACTIVITY,
       DATESENT AS ACTIVITY_DATE
FROM CHATLOG

UNION ALL

SELECT USERID,
       'Account Created' AS ACTIVITY,
       BIRTHDAY AS ACTIVITY_DATE
FROM USERBASE;

-- 11. Display the USERNAME of all users who have not received an INFRACTION.
SELECT USERNAME FROM USERBASE
MINUS
SELECT u.USERNAME
FROM USERBASE u
JOIN INFRACTIONS i ON u.USERID = i.USERID;

-- 12. Display the TITLE and DESCRIPTION of any COMMUNITYRULES that have
--     not been broken.
-- 12
DESC INFRACTIONS;

DESC COMMUNITYRULES;

SELECT c.TITLE, c.DESCRIPTION
FROM COMMUNITYRULES c
LEFT JOIN INFRACTIONS i
  ON c.RULENUM = i.RULENUM
WHERE i.RULENUM IS NULL;

-- 13. Display the USERNAME and EMAIL of all users who have received a
--     penalty for their INFRACTION.
--     Assumes any infraction implies a penalty.
SELECT DISTINCT u.USERNAME, u.EMAIL
FROM USERBASE u
JOIN INFRACTIONS i ON u.USERID = i.USERID;

-- 14. Display the dates where an INFRACTION was assigned and a USERSUPPORT
--     ticket was submitted on the same day.
--     Assumes INFRACTIONS has DATEASSIGNED and USERSUPPORT has CREATEDDATE.
SELECT i.DATEASSIGNED, s.DATESUBMITTED
FROM INFRACTIONS i
JOIN USERSUPPORT s ON i.DATEASSIGNED = s.DATESUBMITTED;

SELECT table_name 
FROM all_tables 
WHERE table_name = 'USERSUPPORT';

-- 15. Display every COMMUNITYRULES TITLE and PENALTY.
SELECT c.TITLE, i.PENALTY
FROM COMMUNITYRULES c
LEFT JOIN INFRACTIONS i
  ON c.RULENUM = i.RULENUM;

-- 16. Display all data in the COMMUNITYRULES table. Show another column
--     that states "Bannable" for any rule with a 10 or higher
--     SEVERITYPOINT, and "Appealable" for all other rules.
SELECT c.*,
       CASE WHEN SEVERITYPOINT >= 10 THEN 'Bannable' ELSE 'Appealable' END AS RULE_TYPE
FROM COMMUNITYRULES c;

-- 17. Display all data in the USERSUPPORT table. Show another column that
--     states "High Priority" for any ticket that is not closed and has not
--     been updated in the past week.
SELECT table_name
FROM all_tables
WHERE table_name = 'USERSUPPORT';

-- 18. Display the Cartesian Product of the USERSUPPORT table cross joined
--     with the INFRACTIONS table.
SELECT owner, table_name
FROM all_tables
WHERE table_name = 'USERSUPPORT';

-- 19. Display both TICKETIDs and DATEUPDATED for any support tickets that
--     are 'CLOSED' and the last DATEUPDATED was on the same day.
--     Selfâ€‘join to find pairs of closed tickets with identical update dates.


SELECT TICKETID, DATEUPDATED
FROM USERSUPPORT
WHERE STATUS = 'CLOSED'
  AND TRUNC(DATEUPDATED) = TRUNC(SYSDATE);


-- 20. Perform a union all on the USERBASE and INFRACTIONS tables to
--     generate data on user activity.
SELECT USERID, 'USERBASE' AS SOURCE_TABLE, USERNAME AS DETAIL, BIRTHDAY AS EVENT_DATE
FROM USERBASE
UNION ALL
SELECT USERID, 'INFRACTIONS' AS SOURCE_TABLE, 'Infraction' AS DETAIL, DATEASSIGNED AS EVENT_DATE
FROM INFRACTIONS;
