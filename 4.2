SELECT U.USERNAME, MIN(R.RATING) AS LOWEST_RATING
FROM REVIEWS R
JOIN USERS U ON R.USERID = U.USERID   -- join to get the USERNAME from USERS table
GROUP BY U.USERNAME;

SELECT table_name 
FROM user_tables
ORDER BY table_name;

SELECT U.USERNAME, MIN(R.RATING) AS LOWEST_RATING
FROM REVIEWS R
JOIN USERBASE U ON R.USERID = U.USERID
GROUP BY U.USERNAME;

SELECT EMAIL, QUESTION
FROM SECURITYQUESTION;

SELECT column_name
FROM user_tab_columns
WHERE table_name = 'SECURITYQUESTION';

SELECT QUESTION
FROM SECURITYQUESTION;

SELECT U.FIRSTNAME, U.EMAIL, U.WALLETFUNDS
FROM USERBASE U
LEFT JOIN WISHLIST W ON U.USERID = W.USERID
WHERE W.USERID IS NULL;

SELECT U.USERNAME, COUNT(O.ORDERID) AS NUM_PRODUCTS_ORDERED
FROM USERBASE U
LEFT JOIN ORDERS O ON U.USERID = O.USERID
GROUP BY U.USERNAME;

SELECT DISTINCT U.USERNAME,
       TRUNC(MONTHS_BETWEEN(SYSDATE, U.BIRTHDAY)/12) AS AGE
FROM USERBASE U
JOIN ORDERS O ON U.USERID = O.USERID
WHERE O.ORDERDATE >= ADD_MONTHS(SYSDATE, -6);

SELECT column_name
FROM user_tab_columns
WHERE table_name = 'ORDERS';

SELECT DISTINCT U.USERNAME,
       TRUNC(MONTHS_BETWEEN(SYSDATE, U.BIRTHDAY)/12) AS AGE
FROM USERBASE U
JOIN ORDERS O ON U.USERID = O.USERID
WHERE O.PURCHASEDATE >= ADD_MONTHS(SYSDATE, -6);

SELECT column_name
FROM user_tab_columns
WHERE table_name = 'USERBASE';

SELECT USERNAME, BIRTHDAY
FROM USERBASE;

SELECT P.PRODUCTNAME, P.RELEASEDATE, P.PRICE, P.DESCRIPTION
FROM PRODUCTLIST P
JOIN WISHLIST W ON P.PRODUCTCODE = W.PRODUCTCODE;

SELECT P.PRODUCTNAME,
       MAX(R.RATING) AS HIGHEST_RATING,
       COUNT(R.RATING) AS NUM_REVIEWS
FROM PRODUCTLIST P
JOIN REVIEWS R ON P.PRODUCTCODE = R.PRODUCTCODE
GROUP BY P.PRODUCTNAME
ORDER BY HIGHEST_RATING DESC;

CREATE OR REPLACE VIEW HIGH_LOW_RATED_PRODUCTS AS
SELECT P.PRODUCTNAME, P.GENRE, R.RATING
FROM PRODUCTLIST P
JOIN REVIEWS R ON P.PRODUCTCODE = R.PRODUCTCODE
WHERE R.RATING IN (1, 5)
ORDER BY R.RATING ASC;

SELECT P.GENRE, COUNT(O.PRODUCTCODE) AS NUM_PRODUCTS_ORDERED
FROM PRODUCTLIST P
JOIN ORDERS O ON P.PRODUCTCODE = O.PRODUCTCODE
GROUP BY P.GENRE
ORDER BY P.GENRE ASC;

CREATE OR REPLACE VIEW PUBLISHER_STATS AS
SELECT P.PUBLISHER,
       AVG(P.PRICE) AS AVG_PRICE
FROM PRODUCTLIST P
GROUP BY P.PUBLISHER;

SELECT P.PUBLISHER,
       SUM(O.PRICE) AS TOTAL_SPENT
FROM ORDERS O
JOIN PRODUCTLIST P ON O.PRODUCTCODE = P.PRODUCTCODE
GROUP BY P.PUBLISHER
ORDER BY TOTAL_SPENT DESC;

SELECT T.TICKETID, U.USERNAME, U.EMAIL, T.ISSUE
FROM SUPPORTTICKETS T
JOIN USERBASE U ON T.USERID = U.USERID
WHERE T.STATUS IN ('NEW', 'I\N PROGRESS')
ORDER BY T.DATEUPDATED DESC;

SELECT USERNAME, EMAIL
FROM USERBASE;

SELECT U.USERNAME, COUNT(O.PRODUCTCODE) AS NUM_PRODUCTS_ORDERED
FROM USERBASE U
LEFT JOIN ORDERS O ON U.USERID = O.USERID
GROUP BY U.USERNAME;

SELECT USERID, EMAIL
FROM USERBASE
WHERE LOWER(EMAIL) LIKE '%' || LOWER(FIRSTNAME) || '%'
   OR LOWER(EMAIL) LIKE '%' || LOWER(LASTNAME) || '%';

SELECT USERNAME, PASSWORD
FROM USERBASE;

-- 16. Adapted: Cannot run — no support ticket table exists
-- Original question requires a ticket table which is not present in the schema.
-- No data available.

-- 17. Adapted: Cannot run — no support ticket table exists
-- Original question requires ISSUE column in tickets, which is not present.
-- No data available.

-- 18. Adapted: Display USERNAME and PASSWORD for all users
SELECT USERNAME, PASSWORD
FROM USERBASE;

CREATE OR REPLACE VIEW RECENT_PENALTIES AS
SELECT U.USERNAME, I.DATEASSIGNED, I.PENALTY
FROM INFRACTIONS I
JOIN USERBASE U ON I.USERID = U.USERID
WHERE I.PENALTY IS NOT NULL
  AND I.DATEASSIGNED >= ADD_MONTHS(SYSDATE, -1);

SELECT U.USERNAME, U.EMAIL
FROM USERBASE U
WHERE TRUNC(MONTHS_BETWEEN(SYSDATE, U.BIRTHDAY)/12) >= 18
  AND U.USERID NOT IN (
      SELECT USERID
      FROM INFRACTIONS
      WHERE DATEASSIGNED >= ADD_MONTHS(SYSDATE, -4)
  );



SELECT U.USERNAME, I.DATEASSIGNED, C.RULENUM || ' ' || C.TITLE AS FULL_GUIDELINE
FROM INFRACTIONS I
JOIN USERBASE U ON I.USERID = U.USERID
JOIN COMMUNITYRULES C ON I.RULENUM = C.RULENUM;

SELECT U.USERID, U.USERNAME, U.EMAIL, COUNT(I.INFRACTIONID) AS TOTAL_INFRACTIONS
FROM INFRACTIONS I
JOIN USERBASE U ON I.USERID = U.USERID
GROUP BY U.USERID, U.USERNAME, U.EMAIL;

SELECT C.TITLE, C.DESCRIPTION, I.PENALTY
FROM INFRACTIONS I
JOIN COMMUNITYRULES C ON I.RULENUM = C.RULENUM;

SELECT U.USERNAME, COUNT(I.INFRACTIONID) AS NUM_INFRACTIONS
FROM INFRACTIONS I
JOIN USERBASE U ON I.USERID = U.USERID
GROUP BY U.USERNAME
HAVING COUNT(I.INFRACTIONID) >= 15;
